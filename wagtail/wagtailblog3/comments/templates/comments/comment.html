{% load static comment_tags %}

<div class="comment-item" id="comment-{{ comment.id }}" data-comment-id="{{ comment.id }}">
    <div class="comment-avatar">
        <img src="{% static 'comments/img/default-avatar.png' %}" alt="{{ comment.author_user.username }}">
    </div>

    <div class="comment-content">
        <div class="comment-header">
            <span class="comment-author">{{ comment.author_user.username }}</span>
            <span class="comment-time">{{ comment.created_at|date:"Y-m-d H:i" }}</span>
            {% if comment.updated_at != comment.created_at %}
                <span class="comment-edited">(å·²ç¼–è¾‘)</span>
            {% endif %}
        </div>

        <div class="comment-text" id="comment-text-{{ comment.id }}">
            {{ comment.content|linebreaks }}
        </div>

        <div class="comment-actions">
            <!-- ç‚¹èµ/è¸© æŒ‰é’® -->
            <div class="comment-votes">
                <button type="button" class="vote-btn like-btn {% if not user.is_authenticated %}auth-required{% endif %} {% if user_reactions|get_item:comment.id == 1 %}active{% endif %}" data-comment-id="{{ comment.id }}" data-reaction="1">
                    <i class="icon-like">ğŸ‘</i>
                    <span class="like-count">{{ comment.like_count }}</span>
                </button>
                <button type="button" class="vote-btn dislike-btn {% if not user.is_authenticated %}auth-required{% endif %} {% if user_reactions|get_item:comment.id == -1 %}active{% endif %}" data-comment-id="{{ comment.id }}" data-reaction="-1">
                    <i class="icon-dislike">ğŸ‘</i>
                    <span class="dislike-count">{{ comment.dislike_count }}</span>
                </button>
            </div>

            <!-- å›å¤æŒ‰é’® -->
            <button type="button" class="reply-btn {% if not user.is_authenticated %}auth-required{% endif %}" data-comment-id="{{ comment.id }}" data-username="{{ comment.author_user.username }}" data-user-id="{{ comment.author_user.id }}">
                å›å¤
            </button>

            <!-- ç¼–è¾‘æŒ‰é’® (ä»…ä½œè€…) -->
            {% if user.is_authenticated and user.id == comment.author_user.id and comment.is_editable %}
                <button type="button" class="edit-btn" data-comment-id="{{ comment.id }}">
                    ç¼–è¾‘
                </button>
            {% endif %}

            <!-- åˆ é™¤æŒ‰é’® (ä½œè€…æˆ–ç®¡ç†å‘˜) -->
            {% if user.is_authenticated and user.id == comment.author_user.id or user.is_staff %}
                <button type="button" class="delete-btn" data-comment-id="{{ comment.id }}">
                    åˆ é™¤
                </button>
            {% endif %}
        </div>

        <!-- å›å¤åŒºåŸŸ -->
        {% if comment.replies.all|length > 0 %}
            <div class="comment-replies-wrapper">
                <button type="button" class="show-replies-btn" data-comment-id="{{ comment.id }}">
                    æŸ¥çœ‹å…¨éƒ¨ {{ comment.replies.all|length }} æ¡å›å¤
                </button>
                <div class="comment-replies" id="replies-{{ comment.id }}" style="display: none;"></div>
            </div>
        {% else %}
            <div class="comment-replies" id="replies-{{ comment.id }}"></div>
        {% endif %}
    </div>
</div>