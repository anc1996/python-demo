{% load static comment_tags %}

{# å¤–å±‚ div è°ƒæ•´ä¸º Gretzia çš„ .comment ç»“æ„ï¼Œå¹¶æ·»åŠ æˆ‘ä»¬çš„æ•°æ®å±æ€§ #}
<div class="comment"
     id="comment-{{ comment.id }}"
     data-comment-id="{{ comment.id }}"
     data-root-comment-id="{% if comment.parent %}{{ comment.parent.id }}{% else %}{{ comment.id }}{% endif %}">

    <div class="inner-box"> {# å¯¹åº” Gretzia çš„ inner-box #}
        <div class="image"> {# å¯¹åº” Gretzia çš„ image #}
            <img src="{% static 'comments/img/default-avatar.png' %}" alt="{{ comment.author_user.username }}" />
        </div>

        <div class="comment-content-wrapper"> {# æ–°å¢ä¸€ä¸ªwrapperæ¥åŒ…è£¹å³ä¾§å†…å®¹ï¼Œä»¥ä¾¿flexå¸ƒå±€ #}
            {# ä½œè€…åç§°ï¼Œå¯¹åº” Gretzia çš„ h3 #}
            <h3>{{ comment.author_user.username }}</h3>

            {# è¯„è®ºæ—¶é—´ï¼Œå¯ä»¥æ”¾åœ¨ä½œè€…åç§°æ—è¾¹æˆ–å•ç‹¬ä¸€è¡Œ #}
            <div class="comment-meta"> {# æ”¾ç½®æ—¶é—´å’Œç¼–è¾‘çŠ¶æ€ #}
                <span class="comment-time">{{ comment.created_at|date:"Y-m-d H:i" }}</span>
                {% if comment.updated_at != comment.created_at %}
                    <span class="comment-edited">(å·²ç¼–è¾‘)</span>
                {% endif %}
            </div>

            {# è¯„è®ºå†…å®¹ï¼Œå¯¹åº” Gretzia çš„ .text #}
            <div class="text" id="comment-text-{{ comment.id }}">
                {% if comment.replied_to_user and comment.parent %}
                    <span class="replied-to-user">@{{ comment.replied_to_user.username }} </span>
                {% endif %}
                {{ comment.content|render_markdown }} {# åº”ç”¨ render_markdown è¿‡æ»¤å™¨ #}
            </div>

            {# è¯„è®ºæ“ä½œï¼Œä½¿ç”¨ Gretzia çš„ reply-comment æ ·å¼ï¼Œå¹¶æ·»åŠ å…¶ä»–æ“ä½œé“¾æ¥ #}
            <div class="comment-actions-list"> {# æ–°å¢ä¸€ä¸ªåˆ—è¡¨å®¹å™¨æ¥ç»„ç»‡æ“ä½œæŒ‰é’® #}
                <a href="javascript:void(0);" class="reply-comment reply-btn"
                    data-comment-id="{{ comment.id }}"
                    data-username="{{ comment.author_user.username }}"
                    data-user-id="{{ comment.author_user.id }}"
                    data-root-comment-id="{% if comment.parent %}{{ comment.parent.id }}{% else %}{{ comment.id }}{% endif %}"
                    >å›å¤</a>

                <a href="javascript:void(0);" class="vote-link like-btn" data-comment-id="{{ comment.id }}" data-reaction="1">
                    <i class="icon-like">ğŸ‘</i> <span class="like-count">{{ comment.like_count }}</span>
                </a>
                <a href="javascript:void(0);" class="vote-link dislike-btn" data-comment-id="{{ comment.id }}" data-reaction="-1">
                    <i class="icon-dislike">ğŸ‘</i> <span class="dislike-count">{{ comment.dislike_count }}</span>
                </a>

                {% if user.is_authenticated and user.id == comment.author_user.id and comment.is_editable %}
                    <a href="javascript:void(0);" class="action-link edit-btn" data-comment-id="{{ comment.id }}">ç¼–è¾‘</a>
                {% endif %}

                {% if user.is_authenticated %}
                    {% if user.id == comment.author_user.id or user.is_staff %}
                        <a href="javascript:void(0);" class="action-link delete-btn" data-comment-id="{{ comment.id }}">åˆ é™¤</a>
                    {% endif %}
                {% endif %}
            </div>

            {# åŠ¨æ€å›å¤è¡¨å•å®¹å™¨ï¼Œç”¨äº JS æ’å…¥å›å¤è¡¨å• #}
            <div class="dynamic-reply-form-container"></div>

            {# å°† comment-replies-wrapper å’Œ comment-replies æ”¾åœ¨ comment-content-wrapper å†…éƒ¨ #}
            {% if comment.replies.all|length > 0 %}
                <div class="comment-replies-wrapper"> {# ä¿æŒç±»åï¼Œåœ¨ comments.css ä¸­å®šä¹‰ç¼©è¿› #}
                    <button type="button" class="show-replies-btn theme-btn-small" data-comment-id="{{ comment.id }}">
                        æŸ¥çœ‹å…¨éƒ¨ {{ comment.replies.all|length }} æ¡å›å¤
                    </button>
                    <div class="comment-replies" id="replies-{{ comment.id }}" style="display: none;"></div>
                </div>
            {% else %}
                <div class="comment-replies" id="replies-{{ comment.id }}"></div>
            {% endif %}
        </div> {# End comment-content-wrapper #}
    </div> {# End inner-box #}
</div> {# End comment #}