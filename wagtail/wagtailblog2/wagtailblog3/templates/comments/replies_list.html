{% load static comment_tags %}

{% for reply in replies %}
{# å¯¹äºå›å¤ï¼Œå…¶ root-comment-id åº”è¯¥å§‹ç»ˆæ˜¯å…¶çˆ¶è¯„è®ºçš„ ID ##}
<div class="comment nested-comment" {# ä½¿ç”¨ Gretzia çš„ comment ç±»ï¼Œå¹¶æ·»åŠ  nested-comment ä»¥ä¾¿æ ·å¼åŒºåˆ† #}
     id="comment-{{ reply.id }}"
     data-comment-id="{{ reply.id }}"
     data-root-comment-id="{{ reply.parent.id }}">

    <div class="inner-box"> {# å¯¹åº” Gretzia çš„ inner-box #}
        <div class="image"> {# å¯¹åº” Gretzia çš„ image #}
            <img src="{% static 'comments/img/default-avatar.png' %}" alt="{{ reply.author_user.username }}" />
        </div>

        <div class="comment-content-wrapper"> {# æ–°å¢ä¸€ä¸ªwrapperæ¥åŒ…è£¹å³ä¾§å†…å®¹ #}
            {# ä½œè€…åç§°ï¼Œå¯¹åº” Gretzia çš„ h3 #}
            <h3>{{ reply.author_user.username }}</h3>

            {# è¯„è®ºæ—¶é—´ #}
            <div class="comment-meta">
                <span class="comment-time">{{ reply.created_at|date:"Y-m-d H:i" }}</span>
                {% if reply.updated_at != reply.created_at %}
                    <span class="comment-edited">(å·²ç¼–è¾‘)</span>
                {% endif %}
            </div>

            {# è¯„è®ºå†…å®¹ï¼Œå¯¹åº” Gretzia çš„ .text #}
            <div class="text" id="comment-text-{{ reply.id }}">
                {% if reply.replied_to_user %}
                    <span class="replied-to-user">@{{ reply.replied_to_user.username }} </span>
                {% endif %}
                {{ reply.content|render_markdown }} {# åº”ç”¨ render_markdown è¿‡æ»¤å™¨ #}
            </div>

            {# è¯„è®ºæ“ä½œ #}
            <div class="comment-actions-list"> {# æ–°å¢ä¸€ä¸ªåˆ—è¡¨å®¹å™¨æ¥ç»„ç»‡æ“ä½œæŒ‰é’® #}
                <a href="javascript:void(0);" class="reply-comment reply-btn"
                    data-comment-id="{{ reply.id }}"
                    data-username="{{ reply.author_user.username }}"
                    data-user-id="{{ reply.author_user.id }}"
                    data-root-comment-id="{{ reply.parent.id }}"
                    >å›å¤</a>

                <a href="javascript:void(0);"
                   class="vote-link like-btn"
                   data-comment-id="{{ reply.id }}"
                   data-reaction="1"
                   data-url="{% url 'comments:react_to_comment' %}"> <i class="icon-like">ğŸ‘</i> <span class="like-count">{{ reply.like_count }}</span>
                </a>
                <a href="javascript:void(0);"
                   class="vote-link dislike-btn"
                   data-comment-id="{{ reply.id }}"
                   data-reaction="-1"
                   data-url="{% url 'comments:react_to_comment' %}"> <i class="icon-dislike">ğŸ‘</i> <span class="dislike-count">{{ reply.dislike_count }}</span>
                </a>

                {% if user.is_authenticated and user.id == reply.author_user.id and reply.is_editable %}
                    <a href="javascript:void(0);" class="action-link edit-btn"
                       data-comment-id="{{ reply.id }}" data-url="{% url 'comments:edit_comment' %}"> ç¼–è¾‘</a>
                {% endif %}

                {% if user.is_authenticated %}
                    {% if user.id == reply.author_user.id or user.is_staff %}
                        <a href="javascript:void(0);"
                           class="action-link delete-btn"
                           data-comment-id="{{ reply.id }}"
                           data-url="{% url 'comments:delete_comment' %}"> åˆ é™¤
                        </a>
                    {% endif %}
                {% endif %}
            </div>
            {# åŠ¨æ€å›å¤è¡¨å•å®¹å™¨ #}
            <div class="dynamic-reply-form-container"></div>
        </div> {# End comment-content-wrapper #}
    </div> {# End inner-box #}
</div> {# End comment #}
{% endfor %}