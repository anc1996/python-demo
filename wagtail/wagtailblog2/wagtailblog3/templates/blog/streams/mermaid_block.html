{% load mermaid %}

<div class="mermaid-diagram-wrapper">
    {# 标题栏和控制按钮 #}
    <div class="mermaid-header">
        <div style="display: flex; align-items: center;">
            <span class="toggle-icon">▲</span>
            <span class="mermaid-title">📊 Mermaid 图表</span>
        </div>
        <div class="mermaid-toggle-hint">点击折叠/展开</div>
    </div>

    {# 内容区域 #}
    <div class="mermaid-content">
        {# 调试面板 #}
        <details>
            <summary>🐛 查看原始代码</summary>
            <pre>{{ value.code }}</pre>
            <p>💡 如果图表未显示，请检查上面的代码语法是否正确</p>
        </details>

        {# 缩放控制按钮 #}
        <div class="zoom-controls">
            <span class="zoom-title">缩放控制：</span>
            <button data-zoom="in">
                🔍 放大
            </button>
            <button data-zoom="out">
                🔍 缩小
            </button>
            <button data-zoom="reset">
                ↺ 重置
            </button>

            {# ================================================== #}
            {# ★★★ 新增：全屏查看按钮 ★★★ #}
            {# ================================================== #}
            <button data-zoom="fullscreen" class="mermaid-fullscreen-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 5px;"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>
                全屏查看
            </button>

            <span class="zoom-level">100%</span>
        </div>

        {# Mermaid 图表容器 #}
        <div class="mermaid-chart-container">
            <div class="mermaid-inner">
                {% mermaid value.code %}
            </div>
        </div>
    </div>
</div>